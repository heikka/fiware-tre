(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{142:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(17),i=a.n(r),l=a(59),s=(a(67),a(68),a(49)),c=a(50),d=a(60),m=a(51),u=a(61),g=a(52),f=a.n(g),p=function(e){var t=e.height;return o.a.createElement("div",{className:"logo-container",style:{height:t}},o.a.createElement("a",{href:"https://www.capelon.se/"},o.a.createElement("img",{src:f.a,alt:"Capelon"})))},h=function(e){var t=e.link,a=e.active,n=e.children;return o.a.createElement("li",{className:"navigation-item"},o.a.createElement("a",{href:t,className:a?"active":""},n))},v=function(){return o.a.createElement("ul",{className:"navigation-items"},o.a.createElement(h,{link:"/",active:!0},"Tampere"))},w=function(e){var t=e.clicked;return o.a.createElement("div",{className:"drawer-toggle",onClick:t},o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null))},b=function(e){var t=e.drawerToggleClicked;return o.a.createElement("header",{className:"toolbar"},o.a.createElement(w,{clicked:t}),o.a.createElement("div",{className:"logo"},o.a.createElement(p,null)),o.a.createElement("nav",{className:"desktopOnly"},o.a.createElement(v,null)))},A=function(e){var t=e.open,a=(e.closed,["side-drawer","close"]);return t&&(a=["side-drawer","open"]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:a.join(" ")},o.a.createElement("nav",null,o.a.createElement(v,null))))},E=a(8),y=a(5),M="SELECT_MAPPOINT",C="UNSELECT_MAPPOINT",S="CLEAR_MAP_POINTS";function O(){return{type:S}}var j,P=Object(y.b)(function(e,t){return{selectedMapPoints:e.point.selectedMapPoints}},function(e){return{onMapPointClear:function(){return e(O())}}})(function(e,t){var a=e.open,r=(e.closed,e.selectedMapPoints),i=Object(n.useState)(0),l=Object(E.a)(i,2),s=(l[0],l[1],Object(n.useState)(!1)),c=Object(E.a)(s,2),d=c[0],m=c[1];Object(n.useEffect)(function(){r&&r.length?m(!0):m(!1)});var u=["tool-drawer","close-right"];return(a||d)&&(u=["tool-drawer","open-right"]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:u.join(" ")},o.a.createElement("ul",null,r.map(function(e,t){return o.a.createElement("li",{key:t},e.id," ",e.address)}))))}),k=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={showSideDrawer:!1,showToolDrawer:!1},a.sideDrawerClosedHandler=function(){a.setState({showSideDrawer:!1})},a.sideDrawerToggleHandler=function(){a.setState(function(e){return{showSideDrawer:!e.showSideDrawer}})},a.toolDrawerClosedHandler=function(){a.setState({showToolDrawer:!1})},a.toolDrawerToggleHandler=function(){a.setState(function(e){return{showToolDrawer:!e.showToolDrawer}})},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(b,{drawerToggleClicked:this.sideDrawerToggleHandler}),o.a.createElement(A,{open:this.state.showSideDrawer,closed:this.sideDrawerClosedHandler}),o.a.createElement(P,{open:this.state.showToolDrawer,closed:this.toolDrawerClosedHandler}),o.a.createElement("main",{className:"content"},this.props.children))}}]),t}(n.Component),B=function(){return o.a.createElement("div",null)},L=function(e){var t=e.show,a=e.clicked;return t?o.a.createElement("div",{className:"backdrop",onClick:a}):null},F=function(e){var t=e.show,a=e.modalClosed,n=e.children;return o.a.createElement(o.a.Fragment,null,o.a.createElement(L,{show:t,clicked:a}),o.a.createElement("div",{className:"modal",style:{transform:t?"translateY(0)":"translateY(-100vh)",opacity:t?1:0}},n))},D=a(54),T=a.n(D),N=(a(89),a(90)),_=a(91),Y=a(139),I=[{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_error_unsel.png",id:"lightOffError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_normal_unsel.png",id:"lightOff"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_error_unsel.png",id:"lightOnError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_normal_unsel.png",id:"lightOn"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 1.png",id:"wastebin"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/site_medium_off_auto_con_normal_sel.png",id:"cabinet_auto_off"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_notcommissioned_disc_normal_sel.png",id:"ambientlightsensor"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_low"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 2.png",id:"wastebin_half"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_full"}],x=Object(y.b)(function(e){return{selectedMapPoints:e.map.selectedMapPoints}})(function(e){var t=e.mapPointSelected,a=e.clearAllSelectedMapPoints,r=Object(n.useState)([]),i=Object(E.a)(r,2),l=i[0],s=i[1],c=Object(n.useState)({}),d=Object(E.a)(c,2),m=d[0],u=d[1];return Object(n.useEffect)(function(){if(!l.length){var e="";e="/v2",T.a.get(e,{headers:{"FIWARE-Service":"tampere"}}).then(function(e){for(var t=e.data,a={type:"FeatureCollection",features:[]},n=0;n<t.length;n++){var o=t[n],r=o.location;if(r){var i=r.value.coordinates;if(i){var l=i[0],c=i[1],d=o.daliCommError,m=o.daliDimmingError,g=o.daliGearError,f=o.daliLampError,p=0;!p&&d&&"on"===d.value&&(p=1),!p&&m&&"on"===m.value&&(p=1),!p&&g&&"on"===g.value&&(p=1),!p&&f&&"on"===f.value&&(p=1);var h=o.illuminanceLevel,v=(o.intensity,0);h&&h.value>0&&(v=1);var w=1;if(!v&&p&&(w=2),v||p||(w=3),v&&!p&&(w=4),"WasteContainer"===o.type){w=5;var b=0;o.fillingLevel&&o.fillingLevel.value&&(b=o.fillingLevel.value),b>0&&(w=8),b>=.5&&(w=9),b>=.86&&(w=10)}"StreetlightControlCabinet"===o.type&&(w=6),"AmbientLightSensor"===o.type&&(w=7);var A="",E=o.address;E&&E.value&&E.value&&E.value.streetAddress&&(A=E.value.streetAddress);var y={id:100+n,type:"Feature",geometry:{type:"Point",coordinates:[l,c]},properties:{color:"#ff0000",mag:w,lightOn:v,failure:p,streetAddress:A,itemId:o.id,itemType:o.type}};a.features.push(y)}}}s(t),u(a)}).catch(function(e){console.log("Error:",e),alert("Cannot fetch data! "+e)})}N.accessToken="pk.eyJ1IjoiaGVpa2thIiwiYSI6ImNqd2JybzB0dzA1YXgzem53cWFwd2FnYWYifQ.dfbsP80dQFAG1iOyrQp6mg";var a=new N.Map({container:j,style:"mapbox://styles/heikka/cjwbsr3380hes1clajwsc7m6y",center:[23.7869773,61.4850743],zoom:14}),n=new N.NavigationControl;a.addControl(n,"top-right");var o=new _({displayControlsDefault:!1,controls:{polygon:!0,trash:!0}});a.addControl(o),a.on("draw.create",S),a.on("draw.delete",S),a.on("draw.update",S);var r=new N.Popup({closeButton:!1,closeOnClick:!0}),i=new N.Popup({closeButton:!0,closeOnClick:!1});a.on("mouseenter","streetlight",function(e){a.getCanvas().style.cursor="pointer";var t=e.features[0].properties,n="";n+=t.itemType,n+=" ",n+=t.itemId,n+="<br>",n+=t.streetAddress,n+="",r.setLngLat(e.features[0].geometry.coordinates).setHTML(n).addTo(a)}),a.on("mouseleave","streetlight",function(){a.getCanvas().style.cursor="",r.remove()}),a.on("click","streetlight",function(e){a.getCanvas().style.cursor="pointer";var n=e.features[0].properties;t(n.itemId,n.streetAddress);var o="<div class='popup-menu'>";o+=n.itemType,o+=" ",o+=n.itemId,o+="<br>",o+=n.streetAddress,o+="<hr><a href='#'>Switch ON</a>",o+="<br><a href='#'>Set work in progress</a>",o+="<br><a href='#'>Change dimming group</a>",o+="<br><a href='#'>Create issue</a>",o+="<br><a href='#'>Show details</a>",o+="</div>",i.setLngLat(e.features[0].geometry.coordinates).setHTML(o).addTo(a)});var c=["<",["get","mag"],2],d=["all",[">=",["get","mag"],2],["<",["get","mag"],3]],g=["all",[">=",["get","mag"],3],["<",["get","mag"],4]],f=["all",[">=",["get","mag"],4],["<",["get","mag"],5]],p=["all",[">=",["get","mag"],5],["<",["get","mag"],6]],h=["all",[">=",["get","mag"],6],["<",["get","mag"],7]],v=["all",[">=",["get","mag"],7],["<",["get","mag"],8]],w=["all",[">=",["get","mag"],8],["<",["get","mag"],9]],b=["all",[">=",["get","mag"],9],["<",["get","mag"],10]],A=[">=",["get","mag"],10],E=["get","lightOn"],y=["get","failure"];function M(e){for(var t=[],a=[e.mag1,e.mag2,e.mag3,e.mag4,e.mag5,e.mag6,e.mag7,e.mag8,e.mag9,e.mag10],n=0,o=0;o<a.length;o++)t.push(n),n+=a[o];var r=n>=1e3?22:n>=100?20:n>=10?18:16,i=n>=1e3?50:n>=100?32:n>=10?24:18,l=Math.round(.6*i),s=2*i,c='<svg width="'+s+'" height="'+s+'" viewbox="0 0 '+s+" "+s+'" text-anchor="middle" style="font: '+r+'px sans-serif">',d="#cacace";e.failure>0&&(d="#A20000"),c+=C(.25,.5,i,l,"#cacace"),c+=C(.5,.75,i,l,d);var m="#cacace",u="#cacace";e.lightOn===e.point_count?(u="#FFCC00",m="#FFCC00"):e.lightOn>0&&(m="#FFCC00"),c+=C(.75,1,i,l,m),c+=C(0,.25,i,l,u),c+='<circle cx="'+i+'" cy="'+i+'" r="'+l+'" fill="#225A9A" /><text dominant-baseline="central" fill="#ffffff" transform="translate('+i+", "+i+')">'+n.toLocaleString()+"</text></svg>";var g=document.createElement("div");return g.innerHTML=c,g.firstChild}function C(e,t,a,n,o){t-e===1&&(t-=1e-5);var r=2*Math.PI*(e-.25),i=2*Math.PI*(t-.25),l=Math.cos(r),s=Math.sin(r),c=Math.cos(i),d=Math.sin(i),m=t-e>.5?1:0;return['<path d="M',a+n*l,a+n*s,"L",a+a*l,a+a*s,"A",a,a,0,m,1,a+a*c,a+a*d,"L",a+n*c,a+n*d,"A",n,n,0,m,0,a+n*l,a+n*s,'" fill="'+o+'" stroke="#343332" stroke-width="0.2" stroke-opacity="1" />'].join(" ")}function S(e){var a=o.getAll();if(document.getElementById("calculated-area"),a.features.length>0){Y.area(a);for(var n=0;n<a.features.length;n++){var r=a.features[n].geometry.coordinates,i=Y.polygon(r);l.forEach(function(e){var a=e.location;if(a){var n=a.value.coordinates;if(n){var o=Y.point(n);if(Y.booleanPointInPolygon(o,i)){var r="",l=e.address;l&&l.value&&l.value.streetAddress&&(r=l.value.streetAddress),t(e.id,r)}}}})}}}a.on("load",function(){a.addSource("streetlights",{type:"geojson",data:m,cluster:!0,clusterMaxZoom:14,clusterRadius:55,clusterProperties:{mag1:["+",["case",c,1,0]],mag2:["+",["case",d,1,0]],mag3:["+",["case",g,1,0]],mag4:["+",["case",f,1,0]],mag5:["+",["case",p,1,0]],mag6:["+",["case",h,1,0]],mag7:["+",["case",v,1,0]],mag8:["+",["case",w,1,0]],mag9:["+",["case",b,1,0]],mag10:["+",["case",A,1,0]],lightOn:["+",E],failure:["+",y]}}),Promise.all(I.map(function(e){return new Promise(function(t,n){a.loadImage(e.url,function(n,o){if(n)throw n;a.addImage(e.id,o),t()})})})).then(function(){a.addLayer({id:"streetlight",type:"symbol",source:"streetlights",filter:["!",["has","point_count"]],layout:{"icon-image":["case",c,"lightOnError",d,"lightOffError",g,"lightOff",f,"lightOn",p,"wastebin",h,"cabinet_auto_off",v,"ambientlightsensor",w,"wastebin_low",b,"wastebin_half",A,"wastebin_full","lightOn"],"text-allow-overlap":!0,"icon-allow-overlap":!0,"icon-size":1}})}),a.addLayer({id:"streetlights_label",type:"symbol",source:"streetlights",filter:["!=","cluster",!0],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var e={},t={},n=!1;setInterval(function(){n&&(o(),n=!1)},1e3);var o=function(){for(var n={},o=a.querySourceFeatures("streetlights"),r=0;r<o.length;r++){var i=o[r].geometry.coordinates,l=o[r].properties;if(l.cluster){var s=l.cluster_id,c=e[s];if(!c){var d=M(l);c=e[s]=new N.Marker({element:d}).setLngLat(i)}n[s]=c,t[s]||c.addTo(a)}}for(s in t)n[s]||t[s].remove();t=n};function r(e){n=!0}function i(e){n=!0}function l(e){}a.on("data",function(e){"streetlights"===e.sourceId&&e.isSourceLoaded&&(a.on("move",r),a.on("moveend",i),a.on("zoom",l),o())})})}),o.a.createElement("div",{style:{width:"100%",height:"100%"}},o.a.createElement("div",{ref:function(e){return j=e},className:"absolute top right left bottom",style:{width:"100%",height:"100%"}}),o.a.createElement("button",{onClick:a,style:{position:"absolute",top:75,left:10,border:0,borderRadius:10,height:30,cursor:"pointer"}},"Clear selections"))}),W=Object(y.b)(function(e,t){return e},function(e){return{onMapPointSelected:function(t,a){return e({type:M,payload:{id:t,address:a}})},onClearMapPointSelected:function(t){return e({type:S})}}})(function(e,t){var a=e.onMapPointSelected,n=e.onClearMapPointSelected;return o.a.createElement(o.a.Fragment,null,o.a.createElement(F,{show:t.showDetails},"Site details"),o.a.createElement(x,{zoom:10,mapPointSelected:a,clearAllSelectedMapPoints:n}),o.a.createElement(B,null))}),Z=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(k,null,o.a.createElement(W,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var U=a(6),z=a(55),G=a(56),Q=a(19),R=a(10),J=(a(29),a(57),{selectedMapPoints:[]}),q={selectedMapPoints:[]};a.d(t,"default",function(){return X});var K=Object(U.combineReducers)({map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_MAP_ID":return Object(R.a)({},e,{selectedMapPoints:[].concat(Object(Q.a)(e.selectedMapPoints),[t.payload])});case"UNSELECT_MAP_ID":return{selectedMapPoints:e.selectedMapPoints.filter(function(e){return e.id!==t.payload.id})};default:return e}},point:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return e.selectedMapPoints.includes(t.payload)?e:Object(R.a)({},e,{selectedMapPoints:[].concat(Object(Q.a)(e.selectedMapPoints),[t.payload])});case C:return{selectedMapPoints:e.selectedMapPoints.filter(function(e){return e.id!==t.payload.id})};case S:return Object(R.a)({},e,{selectedMapPoints:[]});default:return e}}});function X(){var e=[G.a],t=U.applyMiddleware.apply(void 0,e);return Object(U.createStore)(K,Object(z.composeWithDevTools)(t))}var H=o.a.createElement(y.a,{store:X()},o.a.createElement(l.a,null,o.a.createElement(Z,null)));i.a.render(H,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},52:function(e,t){e.exports="data:image/png;base64,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"},62:function(e,t,a){e.exports=a(142)},67:function(e,t,a){},68:function(e,t,a){}},[[62,1,2]]]);
//# sourceMappingURL=main.242fac74.chunk.js.map