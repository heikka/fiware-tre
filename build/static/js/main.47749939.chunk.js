(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{28:function(e,t){e.exports="data:image/png;base64,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"},37:function(e,t,a){e.exports=a(68)},42:function(e,t,a){},43:function(e,t,a){},68:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),i=a(11),l=a.n(i),s=a(34),c=(a(42),a(43),a(5)),m=a(6),u=a(8),g=a(7),d=a(9),h=a(28),f=a.n(h),p=function(e){var t=e.height;return o.a.createElement("div",{className:"logo-container",style:{height:t}},o.a.createElement("a",{href:"https://www.capelon.se/"},o.a.createElement("img",{src:f.a,alt:"Capelon"})))},v=function(e){var t=e.link,a=e.active,n=e.children;return o.a.createElement("li",{className:"navigation-item"},o.a.createElement("a",{href:t,className:a?"active":""},n))},w=function(){return o.a.createElement("ul",{className:"navigation-items"},o.a.createElement(v,{link:"/",active:!0},"Tampere"))},b=function(e){var t=e.clicked;return o.a.createElement("div",{className:"drawer-toggle",onClick:t},o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null))},A=function(e){var t=e.drawerToggleClicked;return o.a.createElement("header",{className:"toolbar"},o.a.createElement(b,{clicked:t}),o.a.createElement("div",{className:"logo"},o.a.createElement(p,null)),o.a.createElement("nav",{className:"desktopOnly"},o.a.createElement(w,null)))},E=function(e){var t=e.open,a=(e.closed,["side-drawer","close"]);return t&&(a=["side-drawer","open"]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:a.join(" ")},o.a.createElement("nav",null,o.a.createElement(w,null))))},y=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={showSideDrawer:!1},a.sideDrawerClosedHandler=function(){a.setState({showSideDrawer:!1})},a.sideDrawerToggleHandler=function(){a.setState(function(e){return{showSideDrawer:!e.showSideDrawer}})},a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(A,{drawerToggleClicked:this.sideDrawerToggleHandler}),o.a.createElement(E,{open:this.state.showSideDrawer,closed:this.sideDrawerClosedHandler}),o.a.createElement("main",{className:"content"},this.props.children))}}]),t}(r.Component),C=function(){return o.a.createElement("div",null)},M=a(18),O=a(29),j=a.n(O),S=a(61),k=[{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_error_unsel.png",id:"lightOffError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_normal_unsel.png",id:"lightOff"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_error_unsel.png",id:"lightOnError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_normal_unsel.png",id:"lightOn"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 1.png",id:"wastebin"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/site_medium_off_auto_con_normal_sel.png",id:"cabinet_auto_off"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_notcommissioned_disc_normal_sel.png",id:"ambientlightsensor"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_low"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 2.png",id:"wastebin_half"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_full"}],B=function(e){e.zoom;var t=e.selectMapId,a=Object(r.useState)([]),i=Object(M.a)(a,2),l=i[0],s=i[1],c=Object(r.useState)({}),m=Object(M.a)(c,2),u=m[0],g=m[1];return t(""),Object(r.useEffect)(function(){if(!l.length){var e="";e="/v2",j.a.get(e,{headers:{"FIWARE-Service":"tampere"}}).then(function(e){for(var t=e.data,a={type:"FeatureCollection",features:[]},n=0;n<t.length;n++){var r=t[n],o=r.location;if(o){var i=o.value.coordinates;if(i){var l=i[0],c=i[1],m=r.daliCommError,u=r.daliDimmingError,d=r.daliGearError,h=r.daliLampError,f=0;!f&&m&&"on"===m.value&&(f=1),!f&&u&&"on"===u.value&&(f=1),!f&&d&&"on"===d.value&&(f=1),!f&&h&&"on"===h.value&&(f=1);var p=r.illuminanceLevel,v=(r.intensity,0);p&&p.value>0&&(v=1);var w=1;if(!v&&f&&(w=2),v||f||(w=3),v&&!f&&(w=4),"WasteContainer"===r.type){w=5;var b=0;r.fillingLevel&&r.fillingLevel.value&&(b=r.fillingLevel.value),b>0&&(w=8),b>=.5&&(w=9),b>=.86&&(w=10)}"StreetlightControlCabinet"===r.type&&(w=6),"AmbientLightSensor"===r.type&&(w=7);var A="",E=r.address;E&&E.value&&E.value&&E.value.streetAddress&&(A=E.value.streetAddress);var y={id:100+n,type:"Feature",geometry:{type:"Point",coordinates:[l,c]},properties:{color:"#ff0000",mag:w,lightOn:v,failure:f,streetAddress:A,itemId:r.id,itemType:r.type}};a.features.push(y)}}}s(t),g(a)}).catch(function(e){console.log("Error:",e),alert("Cannot fetch data! "+e)})}S.accessToken="pk.eyJ1IjoiaGVpa2thIiwiYSI6ImNqd2JybzB0dzA1YXgzem53cWFwd2FnYWYifQ.dfbsP80dQFAG1iOyrQp6mg";var a=new S.Map({container:n,style:"mapbox://styles/heikka/cjwbsr3380hes1clajwsc7m6y",center:[23.7869773,61.4850743],zoom:14}),r=new S.NavigationControl;a.addControl(r,"top-right");var o=new S.Popup({closeButton:!1,closeOnClick:!0}),i=new S.Popup({closeButton:!0,closeOnClick:!1});a.on("mouseenter","streetlight",function(e){a.getCanvas().style.cursor="pointer";var t=e.features[0].properties,n="";n+=t.itemType,n+=" ",n+=t.itemId,n+="<br>",n+=t.streetAddress,n+="",o.setLngLat(e.features[0].geometry.coordinates).setHTML(n).addTo(a)}),a.on("mouseleave","streetlight",function(){a.getCanvas().style.cursor="",o.remove()}),a.on("click","streetlight",function(e){console.log("click"),a.getCanvas().style.cursor="pointer";var n=e.features[0].properties,r="<div class='popup-menu'>";r+=n.itemType,r+=" ",r+=n.itemId,r+="<br>",r+=n.streetAddress,t(n.itemId),r+="<hr><a href='#'>Switch ON</a>",r+="<br><a href='#'>Set work in progress</a>",r+="<br><a href='#'>Change dimming group</a>",r+="<br><a href='#'>Create issue</a>",r+="<br><a href='#'>Show details</a>",r+="</div>",i.setLngLat(e.features[0].geometry.coordinates).setHTML(r).addTo(a)});var c=["<",["get","mag"],2],m=["all",[">=",["get","mag"],2],["<",["get","mag"],3]],d=["all",[">=",["get","mag"],3],["<",["get","mag"],4]],h=["all",[">=",["get","mag"],4],["<",["get","mag"],5]],f=["all",[">=",["get","mag"],5],["<",["get","mag"],6]],p=["all",[">=",["get","mag"],6],["<",["get","mag"],7]],v=["all",[">=",["get","mag"],7],["<",["get","mag"],8]],w=["all",[">=",["get","mag"],8],["<",["get","mag"],9]],b=["all",[">=",["get","mag"],9],["<",["get","mag"],10]],A=[">=",["get","mag"],10],E=["get","lightOn"],y=["get","failure"];function C(e){for(var t=[],a=[e.mag1,e.mag2,e.mag3,e.mag4,e.mag5,e.mag6,e.mag7,e.mag8,e.mag9,e.mag10],n=0,r=0;r<a.length;r++)t.push(n),n+=a[r];var o=n>=1e3?22:n>=100?20:n>=10?18:16,i=n>=1e3?50:n>=100?32:n>=10?24:18,l=Math.round(.6*i),s=2*i,c='<svg width="'+s+'" height="'+s+'" viewbox="0 0 '+s+" "+s+'" text-anchor="middle" style="font: '+o+'px sans-serif">',m="#cacace";e.failure>0&&(m="#A20000"),c+=M(.25,.5,i,l,"#cacace"),c+=M(.5,.75,i,l,m);var u="#cacace",g="#cacace";e.lightOn===e.point_count?(g="#FFCC00",u="#FFCC00"):e.lightOn>0&&(u="#FFCC00"),c+=M(.75,1,i,l,u),c+=M(0,.25,i,l,g),c+='<circle cx="'+i+'" cy="'+i+'" r="'+l+'" fill="#225A9A" /><text dominant-baseline="central" fill="#ffffff" transform="translate('+i+", "+i+')">'+n.toLocaleString()+"</text></svg>";var d=document.createElement("div");return d.innerHTML=c,d.firstChild}function M(e,t,a,n,r){t-e===1&&(t-=1e-5);var o=2*Math.PI*(e-.25),i=2*Math.PI*(t-.25),l=Math.cos(o),s=Math.sin(o),c=Math.cos(i),m=Math.sin(i),u=t-e>.5?1:0;return['<path d="M',a+n*l,a+n*s,"L",a+a*l,a+a*s,"A",a,a,0,u,1,a+a*c,a+a*m,"L",a+n*c,a+n*m,"A",n,n,0,u,0,a+n*l,a+n*s,'" fill="'+r+'" stroke="#343332" stroke-width="0.2" stroke-opacity="1" />'].join(" ")}a.on("load",function(){a.addSource("streetlights",{type:"geojson",data:u,cluster:!0,clusterMaxZoom:14,clusterRadius:55,clusterProperties:{mag1:["+",["case",c,1,0]],mag2:["+",["case",m,1,0]],mag3:["+",["case",d,1,0]],mag4:["+",["case",h,1,0]],mag5:["+",["case",f,1,0]],mag6:["+",["case",p,1,0]],mag7:["+",["case",v,1,0]],mag8:["+",["case",w,1,0]],mag9:["+",["case",b,1,0]],mag10:["+",["case",A,1,0]],lightOn:["+",E],failure:["+",y]}}),Promise.all(k.map(function(e){return new Promise(function(t,n){a.loadImage(e.url,function(n,r){if(n)throw n;a.addImage(e.id,r),t()})})})).then(function(){a.addLayer({id:"streetlight",type:"symbol",source:"streetlights",filter:["!",["has","point_count"]],layout:{"icon-image":["case",c,"lightOnError",m,"lightOffError",d,"lightOff",h,"lightOn",f,"wastebin",p,"cabinet_auto_off",v,"ambientlightsensor",w,"wastebin_low",b,"wastebin_half",A,"wastebin_full","lightOn"],"text-allow-overlap":!0,"icon-allow-overlap":!0,"icon-size":1}})}),a.addLayer({id:"streetlights_label",type:"symbol",source:"streetlights",filter:["!=","cluster",!0],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var e={},t={},n=!1;setInterval(function(){n&&(r(),n=!1)},1e3);var r=function(){for(var n={},r=a.querySourceFeatures("streetlights"),o=0;o<r.length;o++){var i=r[o].geometry.coordinates,l=r[o].properties;if(l.cluster){var s=l.cluster_id,c=e[s];if(!c){var m=C(l);c=e[s]=new S.Marker({element:m}).setLngLat(i)}n[s]=c,t[s]||c.addTo(a)}}for(s in t)n[s]||t[s].remove();t=n};function o(e){n=!0}function i(e){n=!0}function l(e){}a.on("data",function(e){"streetlights"===e.sourceId&&e.isSourceLoaded&&(a.on("move",o),a.on("moveend",i),a.on("zoom",l),r())})})}),o.a.createElement("div",{style:{width:"100%",height:"100%"}},o.a.createElement("div",{ref:function(e){return n=e},className:"absolute top right left bottom",style:{width:"100%",height:"100%"}}))},F=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={message:""},a.selectMapIdHandler=function(){},a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement(B,{zoom:10,selectMapId:this.selectMapIdHandler}))}}]),t}(r.Component),L=function(){return o.a.createElement("div",{className:"city-vision"},o.a.createElement(F,null))},Y=function(e){var t=e.show,a=e.clicked;return t?o.a.createElement("div",{className:"backdrop",onClick:a}):null},_=function(e){var t=e.show,a=e.modalClosed,n=e.children;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Y,{show:t,clicked:a}),o.a.createElement("div",{className:"modal",style:{transform:t?"translateY(0)":"translateY(-100vh)",opacity:t?1:0}},n))},I=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1},a.detailsClosedHandler=function(){},a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(_,{show:this.state.showDetails},"Site details"),o.a.createElement(L,null),o.a.createElement(C,null))}}]),t}(r.Component),N=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(y,null,o.a.createElement(I,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var D=a(33),x=a(4),Z=a(31),T=(a(66),a(35)),W=a(36),z={selectedMapPoints:[]},U=x.compose,G=Object(x.combineReducers)({map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_MAP_ID":return console.log("mapreducer SELECT_MAP_ID",t),Object(W.a)({},e,{selectedMapPoints:[].concat(Object(T.a)(e.selectedMapPoints),[t.payload])});case"UNSELECT_MAP_ID":return{selectedMapPoints:e.selectedMapPoints.filter(function(e){return e.id!==t.payload.id})};default:return e}}}),Q=Object(x.createStore)(G,U(Object(x.applyMiddleware)(Z.a))),R=o.a.createElement(D.a,{store:Q},o.a.createElement(s.a,null,o.a.createElement(N,null)));l.a.render(R,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[37,1,2]]]);
//# sourceMappingURL=main.47749939.chunk.js.map