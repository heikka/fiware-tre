{"version":3,"sources":["assets/images/Capelon.png","components/maps/tampere/TampereMap.tsx","components/Logo/Logo.tsx","components/Navigation/NavigationItems/NavigationItem/NavigationItem.tsx","components/Navigation/NavigationItems/NavigationItems.tsx","components/Navigation/SideDrawer/DrawerToggle/DrawerToggle.tsx","components/Navigation/Toolbar/Toolbar.tsx","components/Navigation/SideDrawer/SideDrawer.tsx","hoc/Layout/Layout.tsx","components/Vision/VisionControls/VisionControls.tsx","components/maps/VisionMap.tsx","components/Vision/Vision.tsx","components/Navigation/UI/Backdrop.tsx","components/UI/Modal/Modal.tsx","views/CityVision/CityVision.tsx","App.tsx","serviceWorker.ts","store/map/mapreducers.ts","index.tsx","store/map/maptypes.ts"],"names":["module","exports","mapContainer","Logo","_ref","height","react_default","a","createElement","className","style","href","src","logoImage","alt","navigationItem","link","active","children","NavigationItems","NavigationItem","DrawerToggle","clicked","onClick","Toolbar","drawerToggleClicked","DrawerToggle_DrawerToggle","Logo_Logo","NavigationItems_NavigationItems","SideDrawer","open","attachedClasses","closed","Fragment","join","Layout","_Component","_getPrototypeOf2","_this","Object","classCallCheck","this","_len","arguments","length","args","Array","_key","possibleConstructorReturn","getPrototypeOf","call","apply","concat","state","showSideDrawer","sideDrawerClosedHandler","setState","sideDrawerToggleHandler","prevState","inherits","createClass","key","value","Toolbar_Toolbar","SideDrawer_SideDrawer","props","Component","VisionControls","mapboxgl","require","images","url","id","TampereMap","zoom","selectMapId","_useState","useState","_useState2","slicedToArray","markers","setMarkers","_useState3","_useState4","featureCollection","setFeatureCollection","useEffect","axios","get","headers","FIWARE-Service","then","res","markersList","data","featureColl","type","features","i","marker","location","coordinates","lng","lat","daliCommError","daliDimmingError","daliGearError","daliLampError","failure","illuminanceLevel","lightOn","mag","fillingLevel","streetAddress","address","feature","geometry","properties","color","itemId","itemType","push","catch","e","console","log","alert","accessToken","map","Map","container","center","nav","NavigationControl","addControl","popup","Popup","closeButton","closeOnClick","popupMenu","on","getCanvas","cursor","p","html","setLngLat","setHTML","addTo","remove","mag1","mag2","mag3","mag4","mag5","mag6","mag7","mag8","mag9","mag10","createDonutChart","offsets","counts","total","fontSize","r","r0","Math","round","w","failColorLeft","donutSegment","lightColorLeft","lightColorRight","point_count","toLocaleString","el","document","innerHTML","firstChild","start","end","a0","PI","a1","x0","cos","y0","sin","x1","y1","largeArc","addSource","cluster","clusterMaxZoom","clusterRadius","clusterProperties","Promise","all","img","resolve","reject","loadImage","error","addImage","addLayer","source","filter","layout","icon-image","text-allow-overlap","icon-allow-overlap","icon-size","text-field","text-font","text-size","paint","text-color","markersOnScreen","doUpdateMarkers","setInterval","updateMarkers","newMarkers","querySourceFeatures","coords","cluster_id","Marker","element","onMove","onMoveend","onZoom","sourceId","isSourceLoaded","width","ref","VisionMap","_React$Component","message","selectMapIdHandler","react","TampereMap_TampereMap","React","Vision","VisionMap_VisionMap","Backdrop","show","Modal","modalClosed","Backdrop_Backdrop","transform","opacity","CityVision","showDetails","detailsClosedHandler","Modal_Modal","Vision_Vision","VisionControls_VisionControls","App","Layout_Layout","CityVision_CityVision","Boolean","window","hostname","match","initialState","selectedMapPoints","composeEnhancers","compose","rootReducer","combineReducers","undefined","action","objectSpread","toConsumableArray","payload","mapPoint","store","createStore","applyMiddleware","thunk","app","es","react_router_dom","src_App_0","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.47749939.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","import React, { useState, useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport axios from 'axios';\r\n\r\nimport {\r\n    Feature, FeatureCollection, GeometryCollection, LineString,\r\n    MultiLineString, MultiPoint, MultiPolygon, Point, Polygon, GeoJsonGeometryTypes,\r\n    GeoJsonTypes, GeometryObject, Geometry\r\n} from \"geojson\";\r\nimport { identifier, updateExpression } from '@babel/types';\r\n\r\n\r\nimport { MapState } from '../../../store/map/maptypes';\r\nimport { selectMapId, unselectMapId } from '../../../store/map/mapactions';\r\nimport { AppState } from '../../../store';\r\n\r\n\r\nvar mapboxgl = require('mapbox-gl/dist/mapbox-gl.js');\r\n\r\ninterface LatLng {\r\n    lat: number,\r\n    lng: number,\r\n    radius?: number,\r\n    lampOffCnt?: number,\r\n    lampOnCnt?: number,\r\n    alarm?: boolean,\r\n    markerCnt?: number\r\n}\r\n\r\ninterface MapProps {\r\n    //readonly selectMapId?: typeof selectMapId,\r\n    selectMapId: (id: string) => void;\r\n//    readonly unselectMapId?: typeof unselectMapId,\r\n//    readonly map?: MapState,\r\n    readonly zoom: number\r\n}\r\n\r\n\r\nlet mapContainer: any;\r\n\r\nconst images = [\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_error_unsel.png', id: 'lightOffError' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_normal_unsel.png', id: 'lightOff' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_error_unsel.png', id: 'lightOnError' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_normal_unsel.png', id: 'lightOn' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 1.png', id: 'wastebin' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/site_medium_off_auto_con_normal_sel.png', id: 'cabinet_auto_off' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_notcommissioned_disc_normal_sel.png', id: 'ambientlightsensor' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png', id: 'wastebin_low' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 2.png', id: 'wastebin_half' },\r\n    { url: 'http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png', id: 'wastebin_full' },\r\n];\r\n\r\n\r\nexport const TampereMap: React.SFC<MapProps> = ({zoom, selectMapId}: MapProps) => {\r\n\r\n    const [markers, setMarkers] = useState([]);\r\n    const [featureCollection, setFeatureCollection] = useState({        \r\n    });\r\n\r\n    selectMapId('');\r\n\r\n    useEffect(() => {\r\n\r\n        if (!markers.length) {\r\n            {\r\n                let url = '';\r\n                if (!process.env.NODE_ENV || process.env.NODE_ENV === 'development') {\r\n                    // dev code\r\n                    url = 'https://context.tampere.fiware.cityvision.cloud/v2/entities?limit=800&offset=0';\r\n                    url += \"&type=Streetlight%2CStreetlightControlCabinet%2CAmbientLightSensor%2CWasteContainer\";\r\n                } else {\r\n                    // production code\r\n                    url = '/v2';\r\n                }\r\n\r\n                //let url = 'https://context.pre.fiware.cityvision.cloud/v2/entities?type=Streetlight&limit=400&offset=0';\r\n                //let url = 'https://context.tampere.fiware.cityvision.cloud/v2/entities?q=dateModified%3E2019-06-05T12:48:00Z';\r\n                //let url = 'https://context.tampere.fiware.cityvision.cloud/v2/entities?limit=800&offset=0';\r\n                //url += \"&type=Streetlight%2CStreetlightControlCabinet%2CAmbientLightSensor%2CWasteContainer\";\r\n                axios.get(url,\r\n                    { 'headers': { \"FIWARE-Service\": \"tampere\" } })\r\n                    .then(res => {\r\n                        const markersList = res.data;\r\n                        //console.log(markersList);\r\n\r\n                        const featureColl: FeatureCollection = {\r\n                            type: 'FeatureCollection',\r\n                            features: []\r\n                        };\r\n\r\n                        for (let i: number = 0; i < markersList.length; i++) {\r\n\r\n                            let marker = markersList[i];\r\n                            //console.log('marker:', marker);\r\n                            let location = marker[\"location\"];\r\n                            if (location) {\r\n                                //if (location && marker.type === 'WasteContainer') {\r\n                                //  console.log('marker', marker);\r\n                                let value = location[\"value\"];\r\n                                let coordinates = value[\"coordinates\"];\r\n                                if (coordinates) {\r\n\r\n                                    let lng = coordinates[0];\r\n                                    let lat = coordinates[1];\r\n\r\n                                    let daliCommError = marker[\"daliCommError\"];\r\n                                    let daliDimmingError = marker[\"daliDimmingError\"];\r\n                                    let daliGearError = marker[\"daliGearError\"];\r\n                                    let daliLampError = marker[\"daliLampError\"];\r\n\r\n                                    let failure = 0;\r\n\r\n                                    if (!failure && daliCommError && daliCommError.value === \"on\") {\r\n                                        failure = 1;\r\n                                    }\r\n\r\n                                    if (!failure && daliDimmingError && daliDimmingError.value === \"on\") {\r\n                                        failure = 1;\r\n                                    }\r\n\r\n                                    if (!failure && daliGearError && daliGearError.value === \"on\") {\r\n                                        failure = 1;\r\n                                    }\r\n\r\n                                    if (!failure && daliLampError && daliLampError.value === \"on\") {\r\n                                        failure = 1;\r\n                                    }\r\n\r\n\r\n                                    let illuminanceLevel = marker[\"illuminanceLevel\"];\r\n                                    let intensity = marker[\"intensity\"];\r\n                                    /*\r\n                                    if (illuminanceLevel)\r\n                                        console.log(\"illuminanceLevel\", illuminanceLevel.value);\r\n                                    if (intensity)                                        \r\n                                        console.log(\"intensity\", intensity.value);\r\n                                    */\r\n\r\n                                    let lightOn = 0;\r\n                                    if (illuminanceLevel && illuminanceLevel.value > 0)\r\n                                        lightOn = 1.0;\r\n\r\n                                    let mag = 1;\r\n                                    if (!lightOn && failure)\r\n                                        mag = 2;\r\n                                    if (!lightOn && !failure)\r\n                                        mag = 3;\r\n                                    if (lightOn && !failure)\r\n                                        mag = 4;\r\n\r\n                                    // console.log(marker.type);\r\n                                    // Streetlight\r\n                                    // WasteContainer\r\n                                    // AmbientLightSensor\r\n                                    // StreetlightControlCabinet\r\n                                    if (marker.type === 'WasteContainer') {\r\n                                        mag = 5;\r\n                                        let fillingLevel = 0;\r\n                                        if (marker.fillingLevel && marker.fillingLevel.value)\r\n                                            fillingLevel = marker.fillingLevel.value;\r\n                                        /*\r\n                                                                                    > 0-49%: green\r\n                                                                                    > \r\n                                                                                    > 50-85%: yellow\r\n                                                                                    > \r\n                                                                                    > 86-100% red\r\n                                                                                    > \r\n                                        */\r\n                                        if (fillingLevel > 0)\r\n                                            mag = 8;\r\n\r\n                                        if (fillingLevel >= 0.50)\r\n                                            mag = 9;\r\n\r\n                                        if (fillingLevel >= 0.86)\r\n                                            mag = 10;\r\n\r\n                                    }\r\n\r\n\r\n                                    if (marker.type === 'StreetlightControlCabinet')\r\n                                        mag = 6;\r\n\r\n                                    if (marker.type === 'AmbientLightSensor')\r\n                                        mag = 7;\r\n\r\n                                    let streetAddress = \"\";\r\n                                    let address = marker[\"address\"];\r\n                                    if (address && address.value && address.value && address.value.streetAddress)\r\n                                        streetAddress = address.value.streetAddress;\r\n\r\n\r\n                                    const feature: Feature = {\r\n                                        id: 100 + i,\r\n                                        type: \"Feature\",\r\n                                        geometry: {\r\n                                            type: \"Point\",\r\n                                            coordinates: [lng, lat]\r\n                                        },\r\n                                        properties: {\r\n                                            color: \"#ff0000\",\r\n                                            mag: mag,\r\n                                            lightOn: lightOn,\r\n                                            failure: failure,\r\n                                            streetAddress: streetAddress,\r\n                                            itemId: marker.id,\r\n                                            itemType: marker.type\r\n                                        }\r\n                                    };\r\n\r\n                                    featureColl.features.push(feature);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        setMarkers(markersList);\r\n                        setFeatureCollection(featureColl);\r\n                    })\r\n                    .catch(e => {\r\n                        console.log('Error:', e);\r\n                        alert('Cannot fetch data! ' + e)\r\n                    })\r\n            }\r\n        }\r\n\r\n        mapboxgl.accessToken = 'pk.eyJ1IjoiaGVpa2thIiwiYSI6ImNqd2JybzB0dzA1YXgzem53cWFwd2FnYWYifQ.dfbsP80dQFAG1iOyrQp6mg';\r\n        var map = new mapboxgl.Map({\r\n            container: mapContainer,\r\n            style: 'mapbox://styles/heikka/cjwbsr3380hes1clajwsc7m6y',\r\n            center: [23.7869773, 61.4850743],\r\n            zoom: 14\r\n        });\r\n\r\n        const nav = new mapboxgl.NavigationControl();\r\n        map.addControl(nav, 'top-right');\r\n\r\n        var popup = new mapboxgl.Popup({\r\n            closeButton: false,\r\n            closeOnClick: true\r\n        });\r\n\r\n        var popupMenu = new mapboxgl.Popup({\r\n            closeButton: true,\r\n            closeOnClick: false\r\n        });\r\n\r\n        map.on('mouseenter', 'streetlight', function (e: any) {\r\n            //map.on('mouseenter', 'streetlight', function (e: any) {\r\n            // Change the cursor style as a UI indicator.\r\n            map.getCanvas().style.cursor = 'pointer';\r\n\r\n            // Populate the popup and set its coordinates\r\n            // based on the feature found.\r\n\r\n            let p: any = e.features[0].properties;\r\n\r\n            let html: string = \"\";\r\n            html += p.itemType;\r\n            html += \" \";\r\n            html += p.itemId;\r\n            html += \"<br>\";\r\n            html += p.streetAddress;\r\n            html += \"\";\r\n\r\n            popup.setLngLat(e.features[0].geometry.coordinates)\r\n                //.setHTML(e.features[0].properties.address.value.streetAddress)\r\n                .setHTML(html)\r\n                .addTo(map);\r\n        });\r\n\r\n        map.on('mouseleave', 'streetlight', function () {\r\n            map.getCanvas().style.cursor = '';\r\n            popup.remove();\r\n        });\r\n\r\n\r\n        map.on('click', 'streetlight', function (e: any) {\r\n\r\nconsole.log('click', );\r\n\r\n            //map.on('mouseenter', 'streetlight', function (e: any) {\r\n            // Change the cursor style as a UI indicator.\r\n            map.getCanvas().style.cursor = 'pointer';\r\n\r\n            // Populate the popup and set its coordinates\r\n            // based on the feature found.\r\n\r\n            let p: any = e.features[0].properties;\r\n\r\n            let html: string = \"<div class='popup-menu'>\";\r\n            html += p.itemType;\r\n            html += \" \";\r\n            html += p.itemId;\r\n            html += \"<br>\";\r\n            html += p.streetAddress;\r\n\r\n            selectMapId(p.itemId);\r\n\r\n            html += \"<hr><a href='#'>Switch ON</a>\";\r\n            html += \"<br><a href='#'>Set work in progress</a>\";\r\n            html += \"<br><a href='#'>Change dimming group</a>\";\r\n            html += \"<br><a href='#'>Create issue</a>\";\r\n            html += \"<br><a href='#'>Show details</a>\";\r\n            html += \"</div>\";\r\n\r\n            popupMenu.setLngLat(e.features[0].geometry.coordinates)\r\n                //.setHTML(e.features[0].properties.address.value.streetAddress)\r\n                .setHTML(html)\r\n                .addTo(map);\r\n        });\r\n        /*\r\n                map.on('click', 'streetlight', function (e: any) {\r\n        \r\n                    var coordinates = e.features[0].geometry.coordinates.slice();\r\n                    //var description = e.features[0].properties.description;\r\n        \r\n                    // Ensure that if the map is zoomed out such that multiple\r\n                    // copies of the feature are visible, the popup appears\r\n                    // over the copy being pointed to.\r\n                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\r\n                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\r\n                    }\r\n        \r\n                    console.log(coordinates);\r\n        \r\n                    coordinates[0] += 0.01;\r\n                    //coordinates[1] = e.lngLat.lat;\r\n        \r\n                    let p: any = e.features[0].properties;\r\n        \r\n                    let html: string = \"\";\r\n                    html += p.itemType;\r\n                    html += \" \";\r\n                    html += p.itemId;\r\n                    html += \"<br>\";\r\n                    html += p.streetAddress;\r\n        \r\n                    // e.features[0].geometry.coordinates\r\n                    popupMenu.setLngLat(coordinates)\r\n                        //.setHTML(e.features[0].properties.address.value.streetAddress)\r\n                        .setHTML(html)\r\n                        .addTo(map);\r\n                });\r\n        */\r\n\r\n        // filters for classifying streetlights into five categories based on magnitude\r\n        var mag1 = [\"<\", [\"get\", \"mag\"], 2];\r\n        var mag2 = [\"all\", [\">=\", [\"get\", \"mag\"], 2], [\"<\", [\"get\", \"mag\"], 3]];\r\n        var mag3 = [\"all\", [\">=\", [\"get\", \"mag\"], 3], [\"<\", [\"get\", \"mag\"], 4]];\r\n        var mag4 = [\"all\", [\">=\", [\"get\", \"mag\"], 4], [\"<\", [\"get\", \"mag\"], 5]];\r\n        var mag5 = [\"all\", [\">=\", [\"get\", \"mag\"], 5], [\"<\", [\"get\", \"mag\"], 6]];\r\n        var mag6 = [\"all\", [\">=\", [\"get\", \"mag\"], 6], [\"<\", [\"get\", \"mag\"], 7]];\r\n        var mag7 = [\"all\", [\">=\", [\"get\", \"mag\"], 7], [\"<\", [\"get\", \"mag\"], 8]];\r\n        var mag8 = [\"all\", [\">=\", [\"get\", \"mag\"], 8], [\"<\", [\"get\", \"mag\"], 9]];\r\n        var mag9 = [\"all\", [\">=\", [\"get\", \"mag\"], 9], [\"<\", [\"get\", \"mag\"], 10]];\r\n        var mag10 = [\">=\", [\"get\", \"mag\"], 10];\r\n\r\n        var lightOn = [\"get\", \"lightOn\"];\r\n        var failure = [\"get\", \"failure\"];\r\n\r\n        // colors to use for the categories\r\n        var colors = ['#F3F3F4', '#FFCC00', '#A20000', '#fc4e2a', '#e31a1c'];\r\n\r\n        map.on('load', function () {\r\n            // add a clustered GeoJSON source for a sample set of streetlights\r\n            map.addSource('streetlights', {\r\n                \"type\": \"geojson\",\r\n                \"data\": featureCollection,\r\n                \"cluster\": true,\r\n                \"clusterMaxZoom\": 14,\r\n                \"clusterRadius\": 55,\r\n                \"clusterProperties\": {\r\n                    \"mag1\": [\"+\", [\"case\", mag1, 1, 0]],\r\n                    \"mag2\": [\"+\", [\"case\", mag2, 1, 0]],\r\n                    \"mag3\": [\"+\", [\"case\", mag3, 1, 0]],\r\n                    \"mag4\": [\"+\", [\"case\", mag4, 1, 0]],\r\n                    \"mag5\": [\"+\", [\"case\", mag5, 1, 0]],\r\n                    \"mag6\": [\"+\", [\"case\", mag6, 1, 0]],\r\n                    \"mag7\": [\"+\", [\"case\", mag7, 1, 0]],\r\n                    \"mag8\": [\"+\", [\"case\", mag8, 1, 0]],\r\n                    \"mag9\": [\"+\", [\"case\", mag9, 1, 0]],\r\n                    \"mag10\": [\"+\", [\"case\", mag10, 1, 0]],\r\n                    \"lightOn\": [\"+\", lightOn],\r\n                    \"failure\": [\"+\", failure],\r\n                }\r\n            });\r\n\r\n            Promise.all(\r\n                images.map(img => new Promise((resolve, reject) => {\r\n                    map.loadImage(img.url, (error: any, res: any) => {\r\n                        if (error)\r\n                            throw error;\r\n\r\n                        map.addImage(img.id, res)\r\n                        resolve();\r\n                    })\r\n                }))\r\n            )\r\n                .then(() => {\r\n\r\n                    /*\r\n                                        map.addLayer({\r\n                                            id: \"clusters\",\r\n                                            type: \"circle\",\r\n                                            source: \"streetlights\",\r\n                                            filter: [\"has\", \"point_count\"],\r\n                                            paint: {\r\n                                                \"circle-radius\": {\r\n                                                    property: \"point_count\",\r\n                                                    type: \"interval\",\r\n                                                    stops: [\r\n                                                        [0, 20],\r\n                                                        [100, 30],\r\n                                                        [750, 40]\r\n                                                    ]\r\n                                                }\r\n                                            }\r\n                                        });\r\n                    */\r\n                    map.addLayer({\r\n                        id: \"streetlight\",\r\n                        type: \"symbol\",\r\n                        source: \"streetlights\",\r\n                        filter: [\"!\", [\"has\", \"point_count\"]],\r\n                        layout: {\r\n                            //\"icon-image\": \"normal\",\r\n                            \"icon-image\": [\"case\",\r\n                                mag1, \"lightOnError\",\r\n                                mag2, \"lightOffError\",\r\n                                mag3, \"lightOff\",\r\n                                mag4, \"lightOn\",\r\n                                mag5, \"wastebin\",\r\n                                mag6, \"cabinet_auto_off\",\r\n                                mag7, \"ambientlightsensor\",\r\n                                mag8, \"wastebin_low\",\r\n                                mag9, \"wastebin_half\",\r\n                                mag10, \"wastebin_full\",\r\n                                \"lightOn\"],\r\n                            \"text-allow-overlap\": true,\r\n                            \"icon-allow-overlap\": true,\r\n                            \"icon-size\": 1.00\r\n                        }\r\n                    });\r\n                });\r\n\r\n            // circle and symbol layers for rendering individual streetlights (unclustered points)\r\n            /*\r\n            map.addLayer({\r\n                \"id\": \"earthquake_circle\",\r\n                \"type\": \"circle\",\r\n                \"source\": \"streetlights\",\r\n                \"filter\": [\"!=\", \"cluster\", true],\r\n                \"paint\": {\r\n                    \"circle-color\": [\"case\",\r\n                        mag1, colors[0],\r\n                        mag2, colors[1],\r\n                        mag3, colors[2],\r\n                        mag4, colors[3], colors[4]],\r\n                    \"circle-opacity\": 0.6,\r\n                    \"circle-radius\": 12\r\n                }\r\n            });\r\n            */\r\n            map.addLayer({\r\n                \"id\": \"streetlights_label\",\r\n                \"type\": \"symbol\",\r\n                \"source\": \"streetlights\",\r\n                \"filter\": [\"!=\", \"cluster\", true],\r\n                \"layout\": {\r\n                    \"text-field\": \"{point_count_abbreviated}\",\r\n                    \"text-font\": [\"Open Sans Semibold\", \"Arial Unicode MS Bold\"],\r\n                    \"text-size\": 10\r\n                },\r\n                \"paint\": {\r\n                    \"text-color\": [\"case\", [\"<\", [\"get\", \"mag\"], 3], \"black\", \"white\"]\r\n                }\r\n            });\r\n\r\n            // objects for caching and keeping track of HTML marker objects (for performance)\r\n            var markers: any = {};\r\n            var markersOnScreen: any = {};\r\n            let doUpdateMarkers = false;\r\n\r\n            let timer = setInterval(checkUpdateMarkers, 1000);\r\n\r\n            function checkUpdateMarkers() {\r\n                if (doUpdateMarkers) {\r\n                    updateMarkers();\r\n                    doUpdateMarkers = false;\r\n                }\r\n            }\r\n\r\n            const updateMarkers = () => {\r\n\r\n                //console.log(new Date(), 'updateMarkers');\r\n                var newMarkers: any = {};\r\n                var features = map.querySourceFeatures('streetlights');\r\n\r\n                //console.log('features', features);\r\n\r\n                // for every cluster on the screen, create an HTML marker for it (if we didn't yet),\r\n                // and add it to the map if it's not there already\r\n                for (var i = 0; i < features.length; i++) {\r\n                    var coords = features[i].geometry.coordinates;\r\n                    var props = features[i].properties;\r\n                    if (!props.cluster) continue;\r\n                    var id = props.cluster_id;\r\n\r\n                    var marker = markers[id];\r\n                    if (!marker) {\r\n                        var el = createDonutChart(props);\r\n                        marker = markers[id] = new mapboxgl.Marker({ element: el }).setLngLat(coords);\r\n                    }\r\n                    newMarkers[id] = marker;\r\n\r\n                    if (!markersOnScreen[id])\r\n                        marker.addTo(map);\r\n                }\r\n                // for every marker we've added previously, remove those that are no longer visible\r\n                for (id in markersOnScreen) {\r\n                    if (!newMarkers[id])\r\n                        markersOnScreen[id].remove();\r\n                }\r\n                markersOnScreen = newMarkers;\r\n            }\r\n\r\n            function onMove(e: any) {\r\n                //console.log('onMove');\r\n                doUpdateMarkers = true;\r\n                //updateMarkers();\r\n            }\r\n\r\n            function onMoveend(e: any) {\r\n                //console.log('onMoveend');\r\n                doUpdateMarkers = true;\r\n                //updateMarkers();\r\n            }\r\n\r\n            function onZoom(e: any) {\r\n                //console.log('onZoom', e);\r\n                //updateMarkers();\r\n            }\r\n\r\n            // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend\r\n            map.on('data', function (e: any) {\r\n                if (e.sourceId !== 'streetlights' || !e.isSourceLoaded) return;\r\n\r\n                //console.log('on data', map);\r\n\r\n                map.on('move', onMove);\r\n                map.on('moveend', onMoveend);\r\n                map.on('zoom', onZoom);\r\n                updateMarkers();\r\n            });\r\n            /*\r\n                        map.on('mousemove', function (e: any) {\r\n            \r\n                            var features = map.queryRenderedFeatures(e.point, {\r\n                                layers: ['clusters']\r\n                            })\r\n            \r\n                            if (features.length)\r\n                                //console.log('features', features);\r\n            \r\n                                var cluster_id = features[0].properties.cluster_id;\r\n                                if (cluster_id) {\r\n                                    console.log('cluster_id', cluster_id);\r\n                                    //var all_features = cluster.getLeaves(cluster_id, Math.floor(map.getZoom()), limit = Infinity);\r\n                                    //console.log(all_features);\r\n                                }\r\n                        });\r\n            */\r\n\r\n        });\r\n\r\n        // code for creating an SVG donut chart from feature properties\r\n        function createDonutChart(props: any) {\r\n            //console.log(props);\r\n            var offsets = [];\r\n            //console.log('props', props);\r\n            var counts = [props.mag1, props.mag2, props.mag3, props.mag4, props.mag5, props.mag6, props.mag7, props.mag8, props.mag9, props.mag10];\r\n            var total = 0;\r\n            for (var i = 0; i < counts.length; i++) {\r\n                offsets.push(total);\r\n                total += counts[i];\r\n            }\r\n            var fontSize = total >= 1000 ? 22 : total >= 100 ? 20 : total >= 10 ? 18 : 16;\r\n            var r = total >= 1000 ? 50 : total >= 100 ? 32 : total >= 10 ? 24 : 18;\r\n            var r0 = Math.round(r * 0.6);\r\n            var w = r * 2;\r\n            //onmouseover=\"alert(1)\" \r\n            var html = '<svg width=\"' + w + '\" height=\"' + w + '\" viewbox=\"0 0 ' + w + ' ' + w +\r\n                '\" text-anchor=\"middle\" style=\"font: ' + fontSize + 'px sans-serif\">';\r\n            /*\r\n            for (i = 0; i < counts.length; i++) {\r\n                html += donutSegment(offsets[i] / total, (offsets[i] + counts[i]) / total, r, r0, colors[i]);\r\n            }\r\n            */\r\n\r\n\r\n            // FAILURES\r\n            //            let failColorLeft = '#F3F3F4';\r\n            //            let failColorRight = '#F3F3F4';\r\n            let failColorLeft = '#cacace';\r\n            let failColorRight = '#cacace';\r\n\r\n            /*            if (props.failure === props.point_count) {\r\n                            failColorRight = '#A20000';\r\n                            failColorLeft = '#A20000';\r\n                        }\r\n                        else {\r\n                            if (props.failure > 0) {\r\n                                failColorLeft = '#A20000';\r\n                            }\r\n                        }\r\n            */\r\n            if (props.failure > 0) {\r\n                failColorLeft = '#A20000';\r\n            }\r\n            html += donutSegment(0.25, 0.5, r, r0, failColorRight);\r\n            html += donutSegment(0.5, 0.75, r, r0, failColorLeft);\r\n\r\n            // LIGHT ON\r\n            let lightColorLeft = '#cacace';\r\n            let lightColorRight = '#cacace';\r\n            if (props.lightOn === props.point_count) {\r\n                lightColorRight = '#FFCC00';\r\n                lightColorLeft = '#FFCC00';\r\n            }\r\n            else {\r\n                if (props.lightOn > 0) {\r\n                    lightColorLeft = '#FFCC00';\r\n                }\r\n            }\r\n\r\n            html += donutSegment(0.75, 1.0, r, r0, lightColorLeft);\r\n            html += donutSegment(0, 0.25, r, r0, lightColorRight);\r\n\r\n            html += '<circle cx=\"' + r + '\" cy=\"' + r + '\" r=\"' + r0 +\r\n                '\" fill=\"#225A9A\" /><text dominant-baseline=\"central\" fill=\"#ffffff\" transform=\"translate(' +\r\n                r + ', ' + r + ')\">' + total.toLocaleString() + '</text></svg>';\r\n\r\n            //html = '<img src=\"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/blank_4.png\" width=\"'+(2*r)+'\" height=\"auto\" />';\r\n            //html = '<div style=\"background-image: url(http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/blank_4.png); background-repeat: no-repeat; width='+r+'px height='+r+'px></div>';\r\n            var el = document.createElement('div');\r\n            el.innerHTML = html;\r\n            return el.firstChild;\r\n        }\r\n\r\n        function donutSegment(start: number, end: number, r: number, r0: number, color: string) {\r\n            if (end - start === 1) end -= 0.00001;\r\n            var a0 = 2 * Math.PI * (start - 0.25);\r\n            var a1 = 2 * Math.PI * (end - 0.25);\r\n            var x0 = Math.cos(a0), y0 = Math.sin(a0);\r\n            var x1 = Math.cos(a1), y1 = Math.sin(a1);\r\n            var largeArc = end - start > 0.5 ? 1 : 0;\r\n\r\n            return ['<path d=\"M', r + r0 * x0, r + r0 * y0, 'L', r + r * x0, r + r * y0,\r\n                'A', r, r, 0, largeArc, 1, r + r * x1, r + r * y1,\r\n                'L', r + r0 * x1, r + r0 * y1, 'A',\r\n                r0, r0, 0, largeArc, 0, r + r0 * x0, r + r0 * y0,\r\n                '\" fill=\"' + color + '\" stroke=\"#343332\" stroke-width=\"0.2\" stroke-opacity=\"1\" />'].join(' ');\r\n        }\r\n\r\n    });\r\n\r\n\r\n    return (\r\n        <div style={{ width: '100%', height: '100%' }}>\r\n            <div ref={el => mapContainer = el} className=\"absolute top right left bottom\" style={{ width: '100%', height: '100%' }} />\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\n\r\nimport logoImage from '../../assets/images/Capelon.png';\r\n\r\ninterface Props {\r\n    readonly height?: number;\r\n}\r\n\r\nexport const Logo = ({ height }: Props) => (\r\n    <div className=\"logo-container\" style={{ height: height }}>\r\n        <a href=\"https://www.capelon.se/\"><img src={logoImage} alt=\"Capelon\" /></a>\r\n    </div>\r\n);\r\n","import React, { ReactNode } from 'react';\r\n\r\ninterface Props {\r\n    readonly link: string;\r\n    readonly active?: boolean;\r\n    readonly children: ReactNode;\r\n}\r\n\r\nconst navigationItem = ({ link, active, children }: Props) => (\r\n    <li className=\"navigation-item\">\r\n        <a\r\n            href={link}\r\n            className={active ? \"active\" : \"\"}>{children}</a>\r\n    </li>\r\n);\r\n\r\nexport default navigationItem;","import React from 'react';\r\n\r\nimport NavigationItem from './NavigationItem/NavigationItem';\r\n\r\nexport const NavigationItems = () => (\r\n    <ul className=\"navigation-items\">\r\n        <NavigationItem link=\"/\" active>Tampere</NavigationItem>\r\n    </ul>\r\n);\r\n\r\n","import React, { MouseEventHandler } from 'react';\r\n\r\ninterface Props {\r\n    readonly clicked: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void\r\n}\r\n\r\nexport const DrawerToggle = ({ clicked }: Props) => (\r\n    <div className=\"drawer-toggle\" onClick={clicked}>\r\n        <div></div>\r\n        <div></div>\r\n        <div></div>\r\n    </div>\r\n);\r\n\r\n","import React from 'react';\r\n\r\nimport { Logo } from '../../Logo/Logo';\r\n\r\nimport { NavigationItems } from '../NavigationItems/NavigationItems';\r\n\r\nimport { DrawerToggle } from '../SideDrawer/DrawerToggle/DrawerToggle';\r\n\r\ninterface Props {\r\n    drawerToggleClicked: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void\r\n}\r\n\r\nexport const Toolbar = ({ drawerToggleClicked }: Props) => (\r\n    <header className=\"toolbar\">\r\n        <DrawerToggle clicked={drawerToggleClicked} />\r\n        <div className=\"logo\">\r\n            <Logo />\r\n        </div>\r\n        <nav className=\"desktopOnly\">\r\n            <NavigationItems />\r\n        </nav>\r\n    </header>\r\n);\r\n\r\n","import React from 'react';\r\n\r\nimport { Logo } from '../../Logo/Logo';\r\nimport { NavigationItems } from '../NavigationItems/NavigationItems';\r\nimport { Backdrop } from '../UI/Backdrop';\r\nimport { TrendChart } from '../../Chart/TrendChart/TrendChart';\r\n\r\ninterface Props {\r\n    readonly open: boolean;\r\n    readonly closed: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void\r\n}\r\n\r\nexport const SideDrawer = ({ open, closed }: Props ) => {\r\n    let attachedClasses = [\"side-drawer\", \"close\"];\r\n    if (open) {\r\n        attachedClasses = [\"side-drawer\", \"open\"];\r\n    }\r\n    return (\r\n        <>\r\n            <div className={attachedClasses.join(' ')}>\r\n                <nav>\r\n                    <NavigationItems />\r\n                </nav>\r\n            </div>\r\n        </>\r\n    );\r\n};","import React, { Component } from 'react';\r\n\r\nimport { Toolbar } from '../../components/Navigation/Toolbar/Toolbar';\r\nimport { SideDrawer } from '../../components/Navigation/SideDrawer/SideDrawer';\r\nimport TrendChart from '../../components/Chart/TrendChart/TrendChart';\r\n\r\ninterface State {\r\n    showSideDrawer: boolean\r\n}\r\n\r\nexport class Layout extends Component {\r\n    state: State = {\r\n        showSideDrawer: false\r\n    }\r\n\r\n    sideDrawerClosedHandler = () => {\r\n        this.setState( { showSideDrawer: false } );\r\n    }\r\n\r\n    sideDrawerToggleHandler = () => {\r\n        this.setState( ( prevState : State ) => {\r\n            return { showSideDrawer: !prevState.showSideDrawer };\r\n        } );\r\n    }\r\n\r\n    render () {\r\n        return (\r\n            <>\r\n                <Toolbar drawerToggleClicked={this.sideDrawerToggleHandler} />\r\n                <SideDrawer\r\n                    open={this.state.showSideDrawer}\r\n                    closed={this.sideDrawerClosedHandler} />\r\n                <main className=\"content\">\r\n                    {this.props.children}\r\n                </main>\r\n            </>\r\n        )\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nexport const VisionControls = () => (\r\n    <div>\r\n    </div>\r\n);\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { AppState } from \"../../store\";\r\n\r\nimport { MapState } from \"../../store/map/maptypes\";\r\nimport { selectMapId } from \"../../store/map/mapactions\";\r\n\r\nimport { TampereMap } from \"./tampere/TampereMap\";\r\n\r\n//import { thunkSelectMapId } from \"./thunks\";\r\n\r\ninterface AppProps {\r\n  selectMapIdHandler: typeof selectMapId;\r\n  map: MapState;\r\n}\r\n\r\nexport type UpdateMessageParam = React.SyntheticEvent<{ value: string }>;\r\n\r\n//export class VisionMap extends React.Component<AppProps> {\r\n  export class VisionMap extends React.Component {  \r\n  state = {\r\n    message: \"\"\r\n  };\r\n/*\r\n  componentDidMount() {\r\n    this.props.selectMapId({\r\n      id: \"MAP_ID_123\"\r\n    });\r\n  }\r\n\r\n  selectMapId = (id: string) => {\r\n    this.props.selectMapId({\r\n      id: id\r\n    });\r\n  };\r\n  */\r\n\r\n  \r\n\r\n  selectMapIdHandler = () => {\r\n    //this.setState({purchasing: true});\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <TampereMap\r\n          zoom={10}\r\n          selectMapId={this.selectMapIdHandler}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\n/*\r\nconst mapStateToProps = (state: AppState) => ({\r\n  map: state.map\r\n});\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  { selectMapId }\r\n)(VisionMap);\r\n*/","import React from 'react';\r\nimport { VisionMap } from '../maps/VisionMap';\r\n\r\nexport const Vision = ( ) => {\r\n    return (\r\n        <div className=\"city-vision\">\r\n            <VisionMap></VisionMap>\r\n        </div>\r\n    );\r\n};\r\n\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    readonly show: boolean;\r\n    readonly clicked?: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void\r\n}\r\n\r\nexport const Backdrop = ({ show, clicked }: Props) => (\r\n    show ? <div className=\"backdrop\" onClick={clicked}></div> : null\r\n);\r\n\r\n","import React, { Component, ReactNode } from 'react';\r\nimport { Backdrop } from '../../Navigation/UI/Backdrop';\r\n\r\ninterface Props {\r\n    readonly show: boolean;\r\n    readonly modalClosed?: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\r\n    readonly children?: ReactNode;\r\n}\r\n\r\nexport const Modal = ({ show, modalClosed, children }: Props) => (\r\n\r\n    /*\r\n    shouldComponentUpdate ( nextProps, nextState ) {\r\n        return nextProps.show !== this.props.show;\r\n    }\r\n*/\r\n\r\n    <>\r\n        <Backdrop show={show} clicked={modalClosed} />\r\n        <div\r\n            className=\"modal\"\r\n            style={{\r\n                transform: show ? 'translateY(0)' : 'translateY(-100vh)',\r\n                opacity: show ? 1 : 0\r\n            }}>\r\n            {children}\r\n        </div>\r\n    </>\r\n);\r\n\r\n","import React, { Component } from 'react';\r\n\r\nimport { VisionControls } from '../../components/Vision/VisionControls/VisionControls';\r\nimport { Vision } from '../../components/Vision/Vision';\r\nimport { Modal } from '../../components/UI/Modal/Modal';\r\n\r\ninterface State {\r\n    readonly showDetails: boolean\r\n}\r\n\r\nexport class CityVision extends Component {\r\n    state: State = {\r\n        showDetails: false\r\n    }\r\n\r\n    detailsClosedHandler: any = (): any => {\r\n    }\r\n\r\n    render () {\r\n        return (\r\n            <>\r\n                <Modal show={this.state.showDetails}>\r\n                    Site details\r\n                </Modal>\r\n                <Vision />\r\n                <VisionControls />\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\n","import React from 'react';\nimport './App.css';\nimport { Layout } from './hoc/Layout/Layout';\nimport { CityVision } from './views/CityVision/CityVision';\n\nconst App: React.FC = () => {\n\n  return (\n    <div className=\"App\">\n      <Layout>\n        <CityVision />\n      </Layout>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import {\r\n    MapState,\r\n    MapActionTypes,\r\n    SELECT_MAP_ID,\r\n    UNSELECT_MAP_ID\r\n} from './maptypes';\r\n\r\n\r\nconst initialState: MapState = {\r\n    selectedMapPoints: []\r\n}\r\n\r\nexport const mapreducer = (state = initialState, action: MapActionTypes) => {\r\n    switch (action.type) {\r\n        case SELECT_MAP_ID:\r\n            console.log('mapreducer SELECT_MAP_ID', action);\r\n            return {\r\n                ...state,\r\n                selectedMapPoints: [...state.selectedMapPoints, action.payload]\r\n            };\r\n        case UNSELECT_MAP_ID:\r\n            return {\r\n                selectedMapPoints: state.selectedMapPoints.filter(\r\n                    mapPoint => mapPoint.id !== action.payload.id\r\n                )\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from 'react-router-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose, combineReducers } from 'redux';\nimport thunk from 'redux-thunk';\nimport { composeWithDevTools } from 'redux-devtools-extension';\n\nimport { mapreducer } from './store/map/mapreducers';\n\nconst composeEnhancers = process.env.NODE_ENV === 'development' ? composeWithDevTools as typeof compose : null || compose;\n\nconst rootReducer = combineReducers({\n    map: mapreducer\n});\n\nconst store = createStore(rootReducer, composeEnhancers(\n    applyMiddleware(thunk)\n));\n\n\nconst app = (\n    <Provider store={store}>\n        <BrowserRouter>\n            <App />\n        </BrowserRouter>\n    </Provider>\n);\n\n\nReactDOM.render(app, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","export const SELECT_MAP_ID = 'SELECT_MAP_ID';\r\nexport const UNSELECT_MAP_ID = 'UNSELECT_MAP_ID';\r\n\r\nexport interface MapPoint {\r\n    id: string\r\n}\r\n\r\nexport interface MapState {\r\n    selectedMapPoints: MapPoint[];\r\n}\r\n\r\ninterface SelectMapIdAction {\r\n    type: typeof SELECT_MAP_ID\r\n    payload: MapPoint\r\n}\r\n\r\ninterface UnselectMapIdAction {\r\n    type: typeof UNSELECT_MAP_ID\r\n    payload: MapPoint\r\n}\r\n\r\nexport type MapActionTypes = SelectMapIdAction | UnselectMapIdAction;"],"sourceRoot":""}