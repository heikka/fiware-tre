(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,a){e.exports=a(40)},21:function(e,t,a){},22:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var o,i=a(1),n=a.n(i),r=a(13),s=a.n(r),l=(a(21),a(22),a(2)),c=a(14),m=a.n(c),g=a(12),u=[{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_error_unsel.png",id:"lightOffError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_off_commissionedok_con_normal_unsel.png",id:"lightOff"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_error_unsel.png",id:"lightOnError"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_commissionedok_con_normal_unsel.png",id:"lightOn"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 1.png",id:"wastebin"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/site_medium_off_auto_con_normal_sel.png",id:"cabinet_auto_off"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/light_medium_on_notcommissioned_disc_normal_sel.png",id:"ambientlightsensor"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_low"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 2.png",id:"wastebin_half"},{url:"http://com.capelon.city-vision.s3-website.eu-north-1.amazonaws.com/images/WA 3.png",id:"wastebin_full"}],d=function(e){var t=Object(i.useState)([]),a=Object(l.a)(t,2),r=a[0],s=a[1],c=Object(i.useState)({}),d=Object(l.a)(c,2),h=d[0],f=d[1];return Object(i.useEffect)(function(){if(!r.length){"&type=Streetlight%2CStreetlightControlCabinet%2CAmbientLightSensor%2CWasteContainer",m.a.get("https://context.tampere.fiware.cityvision.cloud/v2/entities?limit=800&offset=0&type=Streetlight%2CStreetlightControlCabinet%2CAmbientLightSensor%2CWasteContainer",{headers:{"FIWARE-Service":"tampere"}}).then(function(e){for(var t=e.data,a={type:"FeatureCollection",features:[]},o=0;o<t.length;o++){var i=t[o],n=i.location;if(n){var r=n.value.coordinates;if(r){var l=r[0],c=r[1],m=i.daliCommError,g=i.daliDimmingError,u=i.daliGearError,d=i.daliLampError,h=0;!h&&m&&"on"===m.value&&(h=1),!h&&g&&"on"===g.value&&(h=1),!h&&u&&"on"===u.value&&(h=1),!h&&d&&"on"===d.value&&(h=1);var p=i.illuminanceLevel,v=(i.intensity,0);p&&p.value>0&&(v=1);var w=1;if(!v&&h&&(w=2),v||h||(w=3),v&&!h&&(w=4),"WasteContainer"===i.type){w=5;var b=0;i.fillingLevel&&i.fillingLevel.value&&(b=i.fillingLevel.value),b>0&&(w=8),b>=.5&&(w=9),b>=.86&&(w=10)}"StreetlightControlCabinet"===i.type&&(w=6),"AmbientLightSensor"===i.type&&(w=7);var y="",_=i.address;_&&_.value&&_.value&&_.value.streetAddress&&(y=_.value.streetAddress);var C={id:100+o,type:"Feature",geometry:{type:"Point",coordinates:[l,c]},properties:{color:"#ff0000",mag:w,lightOn:v,failure:h,streetAddress:y,itemId:i.id,itemType:i.type}};a.features.push(C)}}}s(t),f(a)}).catch(function(e){console.log("Error:",e),alert("Cannot fetch data! "+e)})}g.accessToken="pk.eyJ1IjoiaGVpa2thIiwiYSI6ImNqd2JybzB0dzA1YXgzem53cWFwd2FnYWYifQ.dfbsP80dQFAG1iOyrQp6mg";var e=new g.Map({container:o,style:"mapbox://styles/heikka/cjwbsr3380hes1clajwsc7m6y",center:[23.7869773,61.4850743],zoom:14});e.addControl(new g.NavigationControl);var t=new g.Popup({closeButton:!1,closeOnClick:!0}),a=new g.Popup({closeButton:!0,closeOnClick:!1});e.on("mouseenter","streetlight",function(a){e.getCanvas().style.cursor="pointer";var o=a.features[0].properties,i="";i+=o.itemType,i+=" ",i+=o.itemId,i+="<br>",i+=o.streetAddress,i+="",t.setLngLat(a.features[0].geometry.coordinates).setHTML(i).addTo(e)}),e.on("mouseleave","streetlight",function(){e.getCanvas().style.cursor="",t.remove()}),e.on("click","streetlight",function(t){e.getCanvas().style.cursor="pointer";var o=t.features[0].properties,i="<div class='popup-menu'>";i+=o.itemType,i+=" ",i+=o.itemId,i+="<br>",i+=o.streetAddress,i+="<hr><a href='#'>Switch ON</a>",i+="<br><a href='#'>Set work in progress</a>",i+="<br><a href='#'>Change dimming group</a>",i+="<br><a href='#'>Create issue</a>",i+="<br><a href='#'>Show alarms</a>",i+="</div>",a.setLngLat(t.features[0].geometry.coordinates).setHTML(i).addTo(e)});var i=["<",["get","mag"],2],n=["all",[">=",["get","mag"],2],["<",["get","mag"],3]],l=["all",[">=",["get","mag"],3],["<",["get","mag"],4]],c=["all",[">=",["get","mag"],4],["<",["get","mag"],5]],d=["all",[">=",["get","mag"],5],["<",["get","mag"],6]],p=["all",[">=",["get","mag"],6],["<",["get","mag"],7]],v=["all",[">=",["get","mag"],7],["<",["get","mag"],8]],w=["all",[">=",["get","mag"],8],["<",["get","mag"],9]],b=["all",[">=",["get","mag"],9],["<",["get","mag"],10]],y=[">=",["get","mag"],10],_=["get","lightOn"],C=["get","failure"];function O(e){for(var t=[],a=[e.mag1,e.mag2,e.mag3,e.mag4,e.mag5,e.mag6,e.mag7,e.mag8,e.mag9,e.mag10],o=0,i=0;i<a.length;i++)t.push(o),o+=a[i];var n=o>=1e3?22:o>=100?20:o>=10?18:16,r=o>=1e3?50:o>=100?32:o>=10?24:18,s=Math.round(.6*r),l=2*r,c='<svg width="'+l+'" height="'+l+'" viewbox="0 0 '+l+" "+l+'" text-anchor="middle" style="font: '+n+'px sans-serif">',m="#cacace";e.failure>0&&(m="#A20000"),c+=L(.25,.5,r,s,"#cacace"),c+=L(.5,.75,r,s,m);var g="#cacace",u="#cacace";e.lightOn===e.point_count?(u="#FFCC00",g="#FFCC00"):e.lightOn>0&&(g="#FFCC00"),c+=L(.75,1,r,s,g),c+=L(0,.25,r,s,u),c+='<circle cx="'+r+'" cy="'+r+'" r="'+s+'" fill="#225A9A" /><text dominant-baseline="central" fill="#ffffff" transform="translate('+r+", "+r+')">'+o.toLocaleString()+"</text></svg>";var d=document.createElement("div");return d.innerHTML=c,d.firstChild}function L(e,t,a,o,i){t-e===1&&(t-=1e-5);var n=2*Math.PI*(e-.25),r=2*Math.PI*(t-.25),s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),m=Math.sin(r),g=t-e>.5?1:0;return['<path d="M',a+o*s,a+o*l,"L",a+a*s,a+a*l,"A",a,a,0,g,1,a+a*c,a+a*m,"L",a+o*c,a+o*m,"A",o,o,0,g,0,a+o*s,a+o*l,'" fill="'+i+'" stroke="#343332" stroke-width="0.2" stroke-opacity="1" />'].join(" ")}e.on("load",function(){e.addSource("streetlights",{type:"geojson",data:h,cluster:!0,clusterMaxZoom:14,clusterRadius:55,clusterProperties:{mag1:["+",["case",i,1,0]],mag2:["+",["case",n,1,0]],mag3:["+",["case",l,1,0]],mag4:["+",["case",c,1,0]],mag5:["+",["case",d,1,0]],mag6:["+",["case",p,1,0]],mag7:["+",["case",v,1,0]],mag8:["+",["case",w,1,0]],mag9:["+",["case",b,1,0]],mag10:["+",["case",y,1,0]],lightOn:["+",_],failure:["+",C]}}),Promise.all(u.map(function(t){return new Promise(function(a,o){e.loadImage(t.url,function(o,i){if(o)throw o;e.addImage(t.id,i),a()})})})).then(function(){e.addLayer({id:"streetlight",type:"symbol",source:"streetlights",filter:["!",["has","point_count"]],layout:{"icon-image":["case",i,"lightOnError",n,"lightOffError",l,"lightOff",c,"lightOn",d,"wastebin",p,"cabinet_auto_off",v,"ambientlightsensor",w,"wastebin_low",b,"wastebin_half",y,"wastebin_full","lightOn"],"text-allow-overlap":!0,"icon-allow-overlap":!0,"icon-size":1}})}),e.addLayer({id:"streetlights_label",type:"symbol",source:"streetlights",filter:["!=","cluster",!0],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var t={},a={},o=!1;setInterval(function(){o&&(r(),o=!1)},1e3);var r=function(){for(var o={},i=e.querySourceFeatures("streetlights"),n=0;n<i.length;n++){var r=i[n].geometry.coordinates,s=i[n].properties;if(s.cluster){var l=s.cluster_id,c=t[l];if(!c){var m=O(s);c=t[l]=new g.Marker({element:m}).setLngLat(r)}o[l]=c,a[l]||c.addTo(e)}}for(l in a)o[l]||a[l].remove();a=o};function s(e){o=!0}function m(e){o=!0}function f(e){}e.on("data",function(t){"streetlights"===t.sourceId&&t.isSourceLoaded&&(e.on("move",s),e.on("moveend",m),e.on("zoom",f),r())})})}),n.a.createElement("div",{style:{width:"100%",height:"100%"}},n.a.createElement("div",{ref:function(e){return o=e},className:"absolute top right left bottom",style:{width:"100%",height:"100%"}}))},h=(a(12),function(){return n.a.createElement("div",{className:"App"},n.a.createElement(d,{zoom:10}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(h,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[15,1,2]]]);
//# sourceMappingURL=main.4c6d0d76.chunk.js.map